# Books API

API разработанный на основе FastAPI, для управления книгами, отзывами и пользователями

## Особенности
- **Взаимодействие с книгами** — CRUD операции для книг
- **Система отзывов** — пользователи могут делать обзоры на книги с рейтингом
- **Пользовательские профили** — полное управление пользователями
- **JWT-аутентификация** — безопасный логин и регистрация
- **Поддержка PostgreSQL** — СУБД, готовая для продакшена
- **Асинхронная архитектура** — высокая производительность с использованием async/await
- **Система админки** — для выполнения части запросов требуются администраторские права

## Установка
### 1. Клонируйте репозиторий
```bash
git clone https://github.com/newyearoldme/books-api.git
cd books-api
```

### 2. Установите зависимости
```bash
poetry install
```

### 3. Настройте .env файл (как пример — .env.example)
```bash
cp .env.example .env
```

### 3.5 Создайте секретный ключ для .env
```bash
poetry run python scripts/generate_secret.py
```

### 4. Создайте таблицы в базе данных
```bash
poetry run python scripts/init_db.py
```

### 5. Запуск приложения
```bash
poetry run python run.py
```
```bash
poetry run uvicorn src.main:app --reload
```

## Эндпоинты
### Admin
- `GET /admin/users/admins` — получение всех администраторов
- `GET /admin/users/banned` — получение всех забаненных пользователей
- `GET /admin/users/inactive` — получение всех неактивных пользователей
- `POST /admin/users/{user_id}/promote` — выдаёт права администратора пользователю
- `POST /admin/users/{user_id}/demote` — снимает права администратора с пользователя
- `POST /admin/users/{user_id}/ban` — банит пользователя
- `POST /admin/users/{user_id}/unban` — разбанивает пользователя
- `POST /admin/users/{user_id}/deactivate` — деактивирует пользователя (мягкое удаление)
- `POST /admin/users/{user_id}/activate` — активирует пользователя

### Auth
- `POST /auth/login` — аутентификация пользователя

### Books
- `POST /books` — создание новой книги (требуются права администратора)
- `GET /books` — получение всех книг
- `GET /books/{book_id}` — получение конкретной книги по ID
- `GET /books/top_rated` — получение наиболее популярной книги по рейтингу
- `PUT /books/{book_id}` — обновление данных книги (требуются права администратора)
- `DELETE /books/{book_id}` — удаление книги (требуются права администратора)

### Favorites
- `POST /favorites/books/{book_id}` — добавление книги в избранное
- `DELETE /favorites/books/{book_id}` — удаление книги с избранного
- `GET /favorites/me` — получение списка избранного текущего пользователя
- `GET /favorites/books/{book_id}/status` — проверка, есть ли книга в избранном

### Review
- `POST /reviews` — создание отзыва к книге
- `GET /reviews` — получение всех отзывов
- `GET /reviews/book/{book_id}` — получение отзывов конкретной книги по ID
- `GET /reviews/user/{user_id}` — получение отзывов конкретного пользователя по ID
- `GET /reviews/{review_id}` — получение отзыва
- `DELETE /reviews/{review_id}` — удаление отзыва (администраторы могут удалять любой отзыв)
- `PUT /reviews/{review_id}` — обновление отзыва
- `GET /reviews/{book_id}/average_rating` — получение среднего рейтинга книги

### Users
- `POST /users` — регистрация нового пользователя
- `GET /users/me` — получение текущего пользователя
- `GET /users` — список всех пользователей (требуются права администратора)
- `GET /users/{user_id}` — получение пользователя по ID (требуются права администратора)
- `GET /users/by_email/{email}` — получение пользователя по электронной почте (требуются права администратора)
- `GET /users/by_username/{username}` — получение пользователя по имени
- `PUT /users/{user_id}` — обновление данных пользователя (пользователь может обновить только себя, администратор может обновить любого)
- `DELETE /users/{user_id}` — удаление пользователя по ID (пользователь может удалить только себя, администратор может удалить любого)

## Тесты
Тесты покрывают все основные CRUD операции. Запуск происходит через
```bash
poetry run pytest -v
```

## Документация
После запуска прилолежния документация доступна по адресам:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc
